(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6457:function(e,t,s){Promise.resolve().then(s.bind(s,3178))},3178:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h},dynamic:function(){return p}});var a=s(3827),r=s(4090),n=s(7907),o=s(2406),l=s(7370),i=s(2897),c=function(e){let{suggestions:t}=e;return(0,a.jsx)("div",{className:"space-y-3 sm:space-y-4",children:t.map((e,t)=>(0,a.jsxs)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1*t},className:"p-3 sm:p-4 rounded-lg shadow bg-white border border-gray-100 hover:shadow-md transition",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-800",children:e.card_name}),(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Reward:"})," ",e.expected_reward]}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-500 mt-1",children:e.reasoning})]},t))})},d=function(e){var t,s;let{card:r}=e,n=(null==r?void 0:null===(s=r.category)||void 0===s?void 0:null===(t=s.toLowerCase)||void 0===t?void 0:t.call(s))||"",o=(null==r?void 0:r.store)||"",l=(null==r?void 0:r.currentQuarter)||"",c=(null==r?void 0:r.card_name)||"Your Card",d="\uD83D\uDCB3",u="smart saver";return n.includes("grocery")||n.includes("supermarket")?(d="\uD83D\uDED2",u="smart shopper"):n.includes("dining")||n.includes("restaurant")?(d="\uD83C\uDF7D️",u="foodie"):n.includes("travel")||n.includes("airline")?(d="✈️",u="travel enthusiast"):n.includes("gas")||n.includes("fuel")?(d="⛽",u="road tripper"):n.includes("online")||n.includes("amazon")?(d="\uD83D\uDECD️",u="online shopper"):(n.includes("entertainment")||n.includes("stream"))&&(d="\uD83C\uDFAC",u="entertainment lover"),(0,a.jsxs)(i.E.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.5},className:" p-4 sm:p-6 rounded-xl bg-gradient-to-r from-blue-100 via-blue-200 to-indigo-100 dark:from-blue-700 dark:via-indigo-800 dark:to-gray-900 text-gray-900 dark:text-gray-100 border border-blue-200 dark:border-indigo-700 shadow-md dark:shadow-lg ",children:[(0,a.jsx)("h2",{className:"text-base sm:text-lg font-semibold mb-2 text-blue-800 dark:text-blue-200",children:"⭐ Best Card Recommendation"}),(0,a.jsx)("h3",{className:"text-xl sm:text-2xl font-bold text-blue-900 dark:text-blue-100",children:c}),(0,a.jsxs)("p",{className:"mt-2 text-sm sm:text-lg font-medium text-gray-800 dark:text-gray-200",children:["Reward: ",r.expected_reward]}),r.reasoning&&(0,a.jsx)("p",{className:"mt-1 text-xs sm:text-sm text-gray-700 dark:text-gray-300",children:r.reasoning}),(0,a.jsxs)(i.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:" mt-4 bg-white/60 dark:bg-white/10 backdrop-blur-md rounded-lg p-3 sm:p-4 shadow-inner ",children:[(0,a.jsxs)("p",{className:"text-sm sm:text-base leading-relaxed text-gray-800 dark:text-gray-200",children:[d," Hey ",u,"!"," ",(0,a.jsx)("strong",{className:"text-blue-800 dark:text-blue-300",children:c})," ","is your top pick right now, earning"," ",(0,a.jsx)("strong",{className:"text-blue-700 dark:text-blue-300",children:r.expected_reward}),o&&(0,a.jsxs)(a.Fragment,{children:[" ","at"," ",(0,a.jsx)("strong",{className:"text-blue-700 dark:text-blue-300",children:o})]}),l&&(0,a.jsxs)(a.Fragment,{children:[" ","during"," ",(0,a.jsx)("strong",{className:"text-blue-700 dark:text-blue-300",children:l})]}),". Keep using it for maximum rewards! \uD83D\uDCB8"]}),n&&(0,a.jsxs)("p",{className:"text-xs sm:text-sm mt-2 text-blue-700 dark:text-blue-300 italic",children:["Because this merchant falls under"," ",(0,a.jsx)("strong",{className:"capitalize",children:n}),", your rewards potential is higher than usual."]})]})]})},u=s(4691),g=s(826),m=s(9263),x=s(8821);let p="force-dynamic";function h(){let e=(0,n.useRouter)(),{user:t,isLoading:i}=(0,o.useAuth)(),[p,h]=(0,r.useState)(null),[f,y]=(0,r.useState)("there"),[v,w]=(0,r.useState)(!0),[b,D]=(0,r.useState)(""),[j,N]=(0,r.useState)([]),[C,k]=(0,r.useState)(!1),[S,A]=(0,r.useState)(null),[P,E]=(0,r.useState)(null),[L,F]=(0,r.useState)(null),[_,U]=(0,r.useState)([]),[R,O]=(0,r.useState)(null),[V,G]=(0,r.useState)(!1),[I,B]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{if(!m.dV.isNativePlatform())return;let e=m.dV.getPlatform();"android"===e?(await x.A_.setOverlaysWebView({overlay:!1}),await x.A_.setStyle({style:x.bg.Dark}),await x.A_.setBackgroundColor({color:"#ffffff"})):"ios"===e&&(await x.A_.setOverlaysWebView({overlay:!1}),await x.A_.setStyle({style:x.bg.Light}))}catch(e){}})()},[]),(0,r.useEffect)(()=>{if(console.log("\uD83D\uDD0D Page.tsx - Auth check - isLoading:",i,"user:",t),i){console.log("⏳ Still loading, waiting...");return}if(!t){let t=new URLSearchParams(window.location.search),s=t.get("status"),a=t.get("userData");if(console.log("\uD83D\uDCF1 Checking URL params - status:",s,"userData:",a?"exists":"none"),"success"===s&&a)try{let e=JSON.parse(decodeURIComponent(a));console.log("✅ Found user data in URL, storing...",e),localStorage.setItem("cardscope_user",JSON.stringify(e)),window.dispatchEvent(new Event("authUpdated")),window.location.href="/";return}catch(e){console.error("❌ Failed to parse user data from URL:",e)}console.log("❌ No auth found, redirecting to login"),e.push("/login");return}console.log("✅ Auth found in page.tsx:",t.email,"name:",t.name),h(t.email),y(t.name||"there")},[i,t,e]),(0,r.useEffect)(()=>{p&&(async()=>{try{var e,t;let s=encodeURIComponent(p),a=await g.Z.get("/api/user/".concat(s)),r=null===(e=a.data)||void 0===e?void 0:e.name,n=Array.isArray(null===(t=a.data)||void 0===t?void 0:t.userCards)?a.data.userCards:[];if(w(n.length>0),r){let e=r.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ");y(e)}}catch(e){console.error("❌ Failed to load profile/name:",e)}})()},[p]);let Z=e=>{var t,s,a;let r=null!==(t=null==e?void 0:e.store)&&void 0!==t?t:null,n=null!==(s=null==e?void 0:e.category)&&void 0!==s?s:null,o=null!==(a=null==e?void 0:e.currentQuarter)&&void 0!==a?a:null,l=Array.isArray(null==e?void 0:e.suggestions)?e.suggestions:[];A(r),E(n),F(o),U(l),O(l.length>0?l[0]:null),r&&D(r)},T=()=>!!v||(B("Please add cards in Settings before getting suggestions."),!1),q=async(e,t)=>{if(!p||!T())return;if(!e.trim()){B("Please Enter store name");return}B(null),G(!0);let s=Date.now();try{let s=await g.Z.post("/api/get-card-suggestions",{email:p,store:e.trim(),category:t||"general"});Z(s.data)}catch(e){console.error("❌ Suggestion error:",e),B("Failed to get suggestions. Please try again.")}finally{let e=1e3-(Date.now()-s);e>0&&await new Promise(t=>setTimeout(t,e)),G(!1),k(!1)}},z=async()=>{var e,t,a,r,n,o;let l,i;if(!p||!T())return;let c=m.dV.isNativePlatform();B(null),G(!0);try{if(c){let{Geolocation:e}=await s.e(350).then(s.bind(s,453));console.log("\uD83D\uDCF1 Requesting location permissions on native platform...");let t=await e.checkPermissions();if("granted"!==t.location){console.log("\uD83D\uDCF1 Location not granted, requesting...");let t=await e.requestPermissions();if("granted"!==t.location){G(!1),B("Location permission is required to detect nearby stores. Please enable it in your device settings.");return}}console.log("\uD83D\uDCF1 Getting current position...");let a=await e.getCurrentPosition({timeout:1e4});l=a.coords.latitude,i=a.coords.longitude,console.log("\uD83D\uDCCD Got position:",l,i)}else{if(!navigator.geolocation){B("Geolocation is not supported by your browser."),G(!1);return}console.log("\uD83C\uDF10 Requesting geolocation from browser...");let e=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{timeout:1e4,enableHighAccuracy:!0})});l=e.coords.latitude,i=e.coords.longitude,console.log("\uD83D\uDCCD Got position:",l,i)}console.log("\uD83C\uDFEC Fetching nearby stores...");let r=await g.Z.get("/api/google/detect-stores-v1",{params:{latitude:l,longitude:i}}),n=[];(null===(t=r.data)||void 0===t?void 0:null===(e=t.stores)||void 0===e?void 0:e.places)&&Array.isArray(r.data.stores.places)?n=r.data.stores.places.map(e=>{var t;return{name:(null===(t=e.displayName)||void 0===t?void 0:t.text)||"Unknown",category:e.primaryType||"general"}}):Array.isArray(null===(a=r.data)||void 0===a?void 0:a.stores)&&(n=r.data.stores.map(e=>({name:e.name,category:e.category}))),0===n.length?await q("Unknown Store","general"):(N(n),k(!0))}catch(e){console.error("❌ Location error:",e),G(!1),(null===(r=e.message)||void 0===r?void 0:r.includes("denied"))||1===e.code?B("Location access denied. Please enable location services in your device settings."):(null===(n=e.message)||void 0===n?void 0:n.includes("timeout"))||3===e.code?B("Location request timed out. Please try again."):(null===(o=e.message)||void 0===o?void 0:o.includes("unavailable"))?B("Location services are unavailable. Please try again later."):B("Unable to get your location. Please check your device settings.")}finally{G(!1)}};if((0,r.useEffect)(()=>{if(!i)return;let s=setTimeout(()=>{console.log("⏱️ Auth check timeout, redirecting to login"),t||e.push("/login")},3e3);return()=>clearTimeout(s)},[i,t,e]),i||!p&&!t)return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 space-y-3",children:[(0,a.jsx)(u.Z,{}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Checking authentication..."})]});if(!t)return console.log("❌ No user found, redirecting to login"),e.push("/login"),null;let J=e=>{switch(e?e.toLowerCase():""){case"groceries":return"text-green-600";case"online":return"text-blue-600";case"department_store":return"text-purple-600";case"dining":case"restaurant":return"text-orange-600";case"travel":return"text-indigo-600";default:return"text-gray-600"}},H=new Date().getHours(),W="Hello",Q="\uD83D\uDCA1";return H<12?(W="Good morning",Q="\uD83C\uDF05"):H<18?(W="Good afternoon",Q="\uD83C\uDF07"):(W="Good evening",Q="\uD83C\uDF19"),(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)("div",{className:"max-w-lg mx-auto w-full px-4 space-y-6 pt-safe-plus",children:[(0,a.jsxs)("div",{className:"space-y-1 mb-4",children:[(0,a.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-800",children:[Q," ",W,", ",f,"!"]}),(0,a.jsxs)("p",{className:"text-sm sm:text-base text-gray-600",children:["Let’s find the"," ",(0,a.jsx)("span",{className:"font-medium text-blue-600",children:"best credit card"})," ","for your next purchase — personalized just for you."]})]}),(0,a.jsx)("button",{onClick:z,className:"btn btn-primary w-full",disabled:V,children:"\uD83D\uDCCD Detect My Store & Get Suggestions"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 mt-2",children:[(0,a.jsx)("input",{className:"flex-1 border p-3 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",placeholder:"Enter store name (e.g. Walmart, Patel Brothers)",value:b,onChange:e=>D(e.target.value),onFocus:e=>{window.visualViewport&&setTimeout(()=>{e.target.scrollIntoView({behavior:"smooth",block:"center"})},100)}}),(0,a.jsx)("button",{onClick:()=>q(b,"general"),className:"btn btn-primary w-full sm:w-auto",children:"Get Suggestions"})]}),I&&(0,a.jsxs)("div",{className:"flex flex-col items-center p-5 rounded-lg bg-yellow-50 border border-yellow-200 text-yellow-800 text-center shadow-sm space-y-2",children:[(0,a.jsx)("div",{className:"text-3xl",children:"⚠️"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold mb-1",children:I.includes("Please Enter store name")?"Store name required":I.includes("add cards")?"Add cards to get started":I.includes("Geolocation")||I.includes("location")?"Location access needed":"Action required"}),(0,a.jsx)("p",{className:"text-sm",children:I})]}),I.includes("add cards")?(0,a.jsx)("button",{onClick:()=>e.push("/settings"),className:"btn btn-primary w-full sm:w-auto",children:"Go to Settings"}):I.includes("location")||I.includes("Geolocation")?(0,a.jsx)("button",{onClick:()=>z(),className:"btn btn-primary w-full sm:w-auto",children:"Try Again"}):null]}),V&&(0,a.jsx)(u.Z,{}),!V&&S&&(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-gray-100 border text-sm text-gray-700 space-y-1",children:[(0,a.jsxs)("div",{children:["\uD83C\uDFEC Store: ",(0,a.jsx)("span",{className:"font-medium",children:S})]}),P&&(0,a.jsxs)("div",{children:["\uD83C\uDFF7️ Category:"," ",(0,a.jsx)("span",{className:"capitalize font-medium ".concat(J(P)),children:P})]}),L&&(0,a.jsxs)("div",{children:["\uD83D\uDCC5 Current Quarter: ",(0,a.jsx)("span",{className:"font-medium",children:L})]})]}),!V&&R&&(0,a.jsx)(d,{card:R}),!V&&_.length>0&&(0,a.jsx)(c,{suggestions:_})]}),C&&j.length>0&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-lg w-11/12 max-w-md p-6 space-y-4",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-800 text-center",children:"Select your store"}),(0,a.jsx)("ul",{className:"space-y-2",children:j.map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>{k(!1),G(!0),setTimeout(()=>q(e.name,e.category),100)},className:"w-full text-left px-4 py-2 border rounded-lg hover:bg-gray-50",children:[e.name," ",(0,a.jsxs)("span",{className:"text-xs font-medium ml-1 ".concat(J(e.category)),children:["(",e.category,")"]})]})},t))}),(0,a.jsx)("button",{onClick:()=>k(!1),className:"btn btn-danger w-full mt-4",children:"Cancel"})]})})]})}},7370:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(3827),r=s(8792),n=s(7907),o=s(4090),l=s(9263),i=s(8821),c=s(2406);function d(e){let{children:t}=e,s=(0,n.usePathname)(),d=(0,n.useRouter)(),{signOut:u}=(0,c.useAuth)();(0,o.useEffect)(()=>{(async()=>{try{if(!l.dV.isNativePlatform())return;let e=l.dV.getPlatform();await i.A_.show(),"ios"===e?(await i.A_.setOverlaysWebView({overlay:!1}),await i.A_.setStyle({style:i.bg.Dark}),await i.A_.setBackgroundColor({color:"#f2f2f2"})):"android"===e&&(await i.A_.setOverlaysWebView({overlay:!0}),await i.A_.setStyle({style:i.bg.Light}),await i.A_.setBackgroundColor({color:"#000000"}))}catch(e){console.warn("StatusBar setup skipped:",e)}})()},[]);let g=async()=>{try{console.log("\uD83D\uDD13 Signing out user..."),u(),d.replace("/login")}catch(e){console.error("❌ Sign-out error:",e)}};return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col font-sans bg-gray-50",style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[(0,a.jsx)("header",{className:"bg-white shadow-sm py-3 rounded-t-2xl overflow-hidden sticky top-0 z-50",style:{top:"env(safe-area-inset-top, 0px)"},children:(0,a.jsxs)("div",{className:"max-w-lg mx-auto w-full px-4 flex justify-between items-center gap-2 min-w-0",children:[(0,a.jsx)("div",{className:"flex-shrink-0 min-w-0",children:"/settings"===s?(0,a.jsx)(r.default,{href:"/",className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition inline-flex items-center justify-center","aria-label":"Home",children:"\uD83C\uDFE0"}):(0,a.jsx)(r.default,{href:"/settings",className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition inline-flex items-center justify-center","aria-label":"Settings",children:"⚙️"})}),(0,a.jsx)("h1",{className:"text-base sm:text-lg font-semibold text-gray-800 flex-1 text-center min-w-0 truncate px-2",children:"/settings"===s?"Settings":"Suggestions"}),(0,a.jsx)("div",{className:"flex-shrink-0 min-w-0",children:(0,a.jsx)("button",{onClick:g,className:"bg-red-600 text-white px-3 py-1 text-xs sm:text-sm rounded-lg font-medium transition hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1 whitespace-nowrap",children:"Sign Out"})})]})}),(0,a.jsx)("main",{className:"flex-1 w-full text-gray-900",children:t}),(0,a.jsx)("footer",{className:"bg-white text-center text-xs text-gray-500 border-t py-3 rounded-b-2xl",children:(0,a.jsxs)("div",{className:"max-w-lg mx-auto w-full px-4 space-y-1",children:[(0,a.jsxs)("div",{children:["\xa9 ",new Date().getFullYear()," CardCompass"]}),(0,a.jsx)("div",{children:(0,a.jsx)(r.default,{href:"/privacy",className:"hover:text-gray-700 underline",children:"Privacy Policy"})})]})})]})}},4691:function(e,t,s){"use strict";var a=s(3827);t.Z=function(){return(0,a.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-blue-500 border-t-transparent"})})}},2406:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return l},useAuth:function(){return i}});var a=s(3827),r=s(4090),n=s(9263);let o=(0,r.createContext)(void 0);function l(e){let{children:t}=e,[s,l]=(0,r.useState)(null),[i,c]=(0,r.useState)(!0),d=()=>{try{if("undefined"==typeof localStorage){console.log("⚠️ localStorage not available"),l(null),c(!1);return}let e=localStorage.getItem("cardscope_user");if(e){let t=JSON.parse(e);l(t),console.log("✅ User found in localStorage:",t.email)}else l(null),console.log("❌ No user found in localStorage")}catch(e){console.error("Error checking auth:",e),l(null)}finally{c(!1)}};(0,r.useEffect)(()=>{if(d(),n.dV.isNativePlatform()){console.log("\uD83D\uDCF1 Setting up deep link listeners...");let e=e=>{var t,s;console.log("\uD83D\uDCF1 Received appUrlOpen event:",null===(t=e.detail)||void 0===t?void 0:t.url),(null===(s=e.detail)||void 0===s?void 0:s.url)&&e.detail.url.includes("cardscope://")&&u(e.detail.url)};window.addEventListener("appUrlOpen",e);let t=e=>{console.log("\uD83D\uDCF1 Received deepLink event from native:",e.detail),u(e.detail)};window.addEventListener("deepLink",t);let s=()=>{let e=window.location.href;e&&e.includes("cardscope://")&&(console.log("\uD83D\uDCF1 Found cardscope:// in window.location:",e),u(e))};s();let a=setInterval(s,1e3);return()=>{window.removeEventListener("appUrlOpen",e),window.removeEventListener("deepLink",t),clearInterval(a)}}let e=e=>{if("cardscope_user"===e.key){if(e.newValue){let t=JSON.parse(e.newValue);l(t),console.log("✅ User updated from storage:",t.email)}else l(null),console.log("❌ User removed from storage")}};window.addEventListener("storage",e);let t=()=>{d()};return window.addEventListener("authUpdated",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("authUpdated",t)}},[]);let u=e=>{try{console.log("\uD83D\uDD17 Processing deep link URL:",e);let t=new URL(e),s=t.searchParams.get("status"),a=t.searchParams.get("userData");if(console.log("\uD83D\uDCF1 Deep link status:",s),console.log("\uD83D\uDCF1 Deep link userData:",a),"success"===s&&a){let e=JSON.parse(decodeURIComponent(a));console.log("\uD83D\uDCF1 Parsed user data from deep link:",e),localStorage.setItem("cardscope_user",JSON.stringify(e)),l(e),window.dispatchEvent(new Event("authUpdated")),console.log("✅ User data stored from deep link")}}catch(e){console.error("Error processing deep link:",e)}};return(0,a.jsx)(o.Provider,{value:{user:s,isLoading:i,signOut:()=>{localStorage.removeItem("cardscope_user"),l(null),console.log("✅ User signed out")}},children:t})}function i(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},826:function(e,t,s){"use strict";var a=s(3107);let r=(()=>{let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"https://cardscope-app.onrender.com":e.includes("10.0.2.2")?"http://10.0.2.2:8080":e.includes("192.168.")||e.includes("172.")?"http://".concat(e,":8080"):"https://cardscope-app.onrender.com"})();console.log("API Base URL →",r);let n=a.Z.create({baseURL:r,headers:{"Content-Type":"application/json"}});n.interceptors.response.use(e=>e,e=>{var t;return console.error("API Error:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),Promise.reject(e)}),t.Z=n}},function(e){e.O(0,[615,263,690,897,971,69,744],function(){return e(e.s=6457)}),_N_E=e.O()}]);