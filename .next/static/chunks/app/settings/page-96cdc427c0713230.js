(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{6370:function(e,t,r){Promise.resolve().then(r.bind(r,4129))},4129:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P},dynamic:function(){return S}});var s=r(3827),n=r(4090),a=r(7907),l=r(2406),o=r(826),i=r(7370),c=r(3856),u=r(2435),d=r(5526),p=r(4561),h=r(4205),f=r(3449);function m(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class g extends n.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,r=(0,h.R)(e)&&e.offsetWidth||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=r-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function x(e){let{children:t,isPresent:r,anchorX:a,root:l}=e,o=(0,n.useId)(),i=(0,n.useRef)(null),c=(0,n.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=(0,n.useContext)(f._),d=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.useCallback(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>{let r=!1,s=t.map(t=>{let s=m(t,e);return r||"function"!=typeof s||(r=!0),s});if(r)return()=>{for(let e=0;e<s.length;e++){let r=s[e];"function"==typeof r?r():m(t[e],null)}}}}(...t),t)}(i,null==t?void 0:t.ref);return(0,n.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:n,right:d}=c.current;if(r||!i.current||!e||!t)return;i.current.dataset.motionPopId=o;let p=document.createElement("style");u&&(p.nonce=u);let h=null!=l?l:document.head;return h.appendChild(p),p.sheet&&p.sheet.insertRule('\n          [data-motion-pop-id="'.concat(o,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            ").concat("left"===a?"left: ".concat(n):"right: ".concat(d),"px !important;\n            top: ").concat(s,"px !important;\n          }\n        ")),()=>{h.contains(p)&&h.removeChild(p)}},[r]),(0,s.jsx)(g,{isPresent:r,childRef:i,sizeRef:c,children:n.cloneElement(t,{ref:d})})}let v=e=>{let{children:t,initial:r,isPresent:a,onExitComplete:l,custom:o,presenceAffectsLayout:i,mode:c,anchorX:d,root:h}=e,f=(0,u.h)(w),m=(0,n.useId)(),g=!0,v=(0,n.useMemo)(()=>(g=!1,{id:m,initial:r,isPresent:a,custom:o,onExitComplete:e=>{for(let t of(f.set(e,!0),f.values()))if(!t)return;l&&l()},register:e=>(f.set(e,!1),()=>f.delete(e))}),[a,f,l]);return i&&g&&(v={...v}),(0,n.useMemo)(()=>{f.forEach((e,t)=>f.set(t,!1))},[a]),n.useEffect(()=>{a||f.size||!l||l()},[a]),"popLayout"===c&&(t=(0,s.jsx)(x,{isPresent:a,anchorX:d,root:h,children:t})),(0,s.jsx)(p.O.Provider,{value:v,children:t})};function w(){return new Map}var y=r(3177);let j=e=>e.key||"";function b(e){let t=[];return n.Children.forEach(e,e=>{(0,n.isValidElement)(e)&&t.push(e)}),t}let C=e=>{let{children:t,custom:r,initial:a=!0,onExitComplete:l,presenceAffectsLayout:o=!0,mode:i="sync",propagate:p=!1,anchorX:h="left",root:f}=e,[m,g]=(0,y.oO)(p),x=(0,n.useMemo)(()=>b(t),[t]),w=p&&!m?[]:x.map(j),C=(0,n.useRef)(!0),N=(0,n.useRef)(x),D=(0,u.h)(()=>new Map),[_,E]=(0,n.useState)(x),[S,P]=(0,n.useState)(x);(0,d.L)(()=>{C.current=!1,N.current=x;for(let e=0;e<S.length;e++){let t=j(S[e]);w.includes(t)?D.delete(t):!0!==D.get(t)&&D.set(t,!1)}},[S,w.length,w.join("-")]);let k=[];if(x!==_){let e=[...x];for(let t=0;t<S.length;t++){let r=S[t],s=j(r);w.includes(s)||(e.splice(t,0,r),k.push(r))}return"wait"===i&&k.length&&(e=k),P(b(e)),E(x),null}let{forceRender:R}=(0,n.useContext)(c.p);return(0,s.jsx)(s.Fragment,{children:S.map(e=>{let t=j(e),n=(!p||!!m)&&(x===S||w.includes(t));return(0,s.jsx)(v,{isPresent:n,initial:(!C.current||!!a)&&void 0,custom:r,presenceAffectsLayout:o,mode:i,root:f,onExitComplete:n?void 0:()=>{if(!D.has(t))return;D.set(t,!0);let e=!0;D.forEach(t=>{t||(e=!1)}),e&&(null==R||R(),P(N.current),p&&(null==g||g()),l&&l())},anchorX:h,children:e},t)})})};var N=r(2897),D=r(4691),_=r(9263),E=r(8821);let S="force-dynamic";function P(){let e=(0,a.useRouter)(),{user:t,isLoading:r}=(0,l.useAuth)(),[c,u]=(0,n.useState)(null),[d,p]=(0,n.useState)(null),[h,f]=(0,n.useState)(""),[m,g]=(0,n.useState)(""),[x,v]=(0,n.useState)([]),[w,y]=(0,n.useState)([]),[j,b]=(0,n.useState)(!1),[S,P]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{if(!_.dV.isNativePlatform())return;"android"===_.dV.getPlatform()&&(await E.A_.setOverlaysWebView({overlay:!1}),await E.A_.setStyle({style:E.bg.Dark}),await E.A_.setBackgroundColor({color:"#ffffff"}))}catch(e){}})()},[]),(0,n.useEffect)(()=>{if(!r){if(!t){e.replace("/login");return}u(t.email)}},[r,t,e]),(0,n.useEffect)(()=>{c&&k(c)},[c]);let k=async e=>{b(!0);try{var t;let r=await o.Z.get("/api/user/".concat(encodeURIComponent(e)));p(null!==(t=r.data)&&void 0!==t?t:{name:"",email:e,userCards:[]})}catch(e){console.error("❌ Failed to load profile:",e)}finally{b(!1)}},R=async e=>{if(!e.trim())return v([]);try{let t=await o.Z.get("/api/cards/issuers?search=".concat(encodeURIComponent(e)));v(t.data||[])}catch(e){console.error("❌ Failed to fetch issuers:",e)}},A=async(e,t)=>{if(!e||!t.trim())return y([]);try{let r=await o.Z.get("/api/cards/products?issuer=".concat(encodeURIComponent(e),"&search=").concat(encodeURIComponent(t)));y(r.data||[])}catch(e){console.error("❌ Failed to fetch products:",e)}},U=async()=>{if(c&&d){b(!0);try{let e={name:d.name,userCards:d.userCards.map(e=>({issuer:e.issuer,cardProduct:e.cardProduct}))},t=await o.Z.put("/api/user/".concat(encodeURIComponent(c)),e);p(t.data)}catch(e){console.error("❌ Failed to save profile:",e)}finally{b(!1)}}},I=e=>{d&&p({...d,userCards:d.userCards.filter((t,r)=>r!==e)})},F=e=>{P(S===e?null:e)},L=async()=>{if(c&&t&&window.confirm("Are you sure you want to delete your account? This action cannot be undone. All your data will be permanently deleted.")){b(!0);try{await o.Z.delete("/api/user/".concat(encodeURIComponent(c))),localStorage.removeItem("cardscope_user"),localStorage.removeItem("auth"),window.dispatchEvent(new Event("authUpdated")),e.replace("/login")}catch(e){var r,s;console.error("❌ Failed to delete account:",e),alert((null===(s=e.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.error)||"Failed to delete account. Please try again.")}finally{b(!1)}}};return!r&&(c||t)?t?(0,s.jsx)(i.Z,{children:(0,s.jsxs)("div",{className:"max-w-lg mx-auto w-full px-4 space-y-6 pt-safe-plus",children:[j&&(0,s.jsx)(D.Z,{}),d&&!j&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4 sm:p-6 space-y-4",children:[(0,s.jsx)("h2",{children:"\uD83D\uDC64 Profile"}),(0,s.jsx)("input",{className:"w-full border p-2 sm:p-3 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",placeholder:"Full Name",value:d.name,onChange:e=>p({...d,name:e.target.value})}),(0,s.jsx)("input",{className:"w-full border p-2 sm:p-3 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",placeholder:"Email",value:d.email,disabled:!0}),(0,s.jsx)("button",{onClick:U,className:"btn btn-success w-full",children:"Save Profile"})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4 sm:p-6",children:[(0,s.jsx)("h2",{children:"\uD83D\uDCB3 Manage Cards"}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[(0,s.jsxs)("div",{className:"relative w-full sm:w-1/2",children:[(0,s.jsx)("input",{className:"w-full border p-2 sm:p-3 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",placeholder:"Card Issuer (e.g., Chase, Amex)",value:h,onChange:e=>{f(e.target.value),R(e.target.value)}}),x.length>0&&(0,s.jsx)("ul",{className:"absolute z-10 bg-white border rounded-lg shadow mt-1 max-h-40 overflow-y-auto w-full",children:x.map((e,t)=>(0,s.jsx)("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-100 text-sm",onClick:()=>{f(e),v([])},children:e},t))})]}),(0,s.jsxs)("div",{className:"relative w-full sm:w-1/2",children:[(0,s.jsx)("input",{className:"w-full border p-2 sm:p-3 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",placeholder:"Card Product (e.g., Sapphire Preferred)",value:m,onChange:e=>{let t=e.target.value;g(t),A(h,t)},disabled:!h}),w.length>0&&(0,s.jsx)("ul",{className:"absolute z-10 bg-white border rounded-lg shadow mt-1 max-h-40 overflow-y-auto w-full",children:w.map((e,t)=>(0,s.jsx)("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-100 text-sm",onClick:()=>{g(e),y([])},children:e},t))})]}),(0,s.jsx)("button",{onClick:()=>{if(d&&h.trim()&&m.trim()){let e={issuer:h.trim(),cardProduct:m.trim(),rewardDetails:{}};p({...d,userCards:[...d.userCards,e]}),f(""),g(""),v([]),y([])}},className:"btn btn-primary w-full sm:w-auto",children:"Add"})]}),(0,s.jsx)("ul",{className:"space-y-2 sm:space-y-3",children:(0,s.jsx)(C,{children:d.userCards.map((e,t)=>{var r,n,a;let l=null===(r=e.rewardDetails)||void 0===r?void 0:r.cardReward,o="".concat(e.issuer,"-").concat(e.cardProduct,"-").concat(t);return(0,s.jsxs)(N.E.li,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"bg-gray-50 border rounded-lg p-3 sm:p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>F(o),children:[(0,s.jsxs)("span",{className:"text-sm sm:text-base font-medium",children:[e.issuer," ",e.cardProduct]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),I(t)},className:"btn btn-danger text-sm",children:"Remove"})]}),S===o&&l&&(0,s.jsxs)(N.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"mt-3 text-sm bg-white border rounded-lg p-3 space-y-2",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Base Rate:"})," ",l.base_rate]}),(null===(n=l.bonus_categories)||void 0===n?void 0:n.length)>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Bonus Categories:"}),(0,s.jsx)("ul",{className:"list-disc pl-5",children:l.bonus_categories.map((e,t)=>{var r;return(0,s.jsxs)("li",{children:[e.category," — ",e.rate,e.cap&&(0,s.jsxs)("span",{children:[" (Cap: ",e.cap,")"]}),e.after_cap_rate&&(0,s.jsxs)("span",{children:[", After Cap: ",e.after_cap_rate]}),(null===(r=e.exclusions)||void 0===r?void 0:r.length)>0&&(0,s.jsxs)("span",{children:[" | Exclusions: ",e.exclusions.join(", ")]})]},t)})})]}),(null===(a=l.user_choice_categories)||void 0===a?void 0:a.length)>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"User Choice Categories:"}),(0,s.jsx)("ul",{className:"list-disc pl-5",children:l.user_choice_categories.map((e,t)=>(0,s.jsxs)("li",{children:[e.rate," on ",e.options.join(", ")," ",e.notes&&"(".concat(e.notes,")")]},t))})]}),l.rotating_categories&&(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Rotating Categories:"}),Object.entries(l.rotating_categories).map(e=>{let[t,r]=e;return r.length>0?(0,s.jsxs)("div",{className:"mt-1",children:[(0,s.jsx)("p",{className:"font-semibold",children:t}),(0,s.jsx)("ul",{className:"list-disc pl-5",children:r.map((e,t)=>{var r;return(0,s.jsxs)("li",{children:[e.category," — ",e.rate,e.notes&&" (".concat(e.notes,")"),(null===(r=e.exclusions)||void 0===r?void 0:r.length)>0&&(0,s.jsxs)("span",{children:[" | Exclusions: ",e.exclusions.join(", ")]})]},t)})})]},t):null})]}),l.redeem_as&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Redeem As:"})," ",l.redeem_as]}),l.annual_fee&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Annual Fee:"})," ",l.annual_fee.first_year," (Then"," ",l.annual_fee.thereafter,")"]}),l.notes&&(0,s.jsx)("p",{className:"italic text-gray-600",children:l.notes})]})]},o)})})}),(0,s.jsx)("button",{onClick:U,className:"btn btn-success w-full mt-4",children:"Save Cards"})]}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg p-4 sm:p-6 border-t-4 border-red-500",children:[(0,s.jsx)("h2",{className:"text-red-600 mb-4",children:"⚠️ Danger Zone"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Once you delete your account, there is no going back. Please be certain."}),(0,s.jsx)("button",{onClick:L,className:"btn btn-danger w-full",disabled:j,children:j?"Deleting...":"Delete My Account"})]})]})]})}):null:(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center text-gray-500",children:"Checking your session..."})}},7370:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var s=r(3827),n=r(8792),a=r(7907),l=r(4090),o=r(9263),i=r(8821),c=r(2406);function u(e){let{children:t}=e,r=(0,a.usePathname)(),u=(0,a.useRouter)(),{signOut:d}=(0,c.useAuth)();(0,l.useEffect)(()=>{(async()=>{try{if(!o.dV.isNativePlatform())return;let e=o.dV.getPlatform();await i.A_.show(),"ios"===e?(await i.A_.setOverlaysWebView({overlay:!1}),await i.A_.setStyle({style:i.bg.Dark}),await i.A_.setBackgroundColor({color:"#f2f2f2"})):"android"===e&&(await i.A_.setOverlaysWebView({overlay:!0}),await i.A_.setStyle({style:i.bg.Light}),await i.A_.setBackgroundColor({color:"#000000"}))}catch(e){console.warn("StatusBar setup skipped:",e)}})()},[]);let p=async()=>{try{console.log("\uD83D\uDD13 Signing out user..."),d(),u.replace("/login")}catch(e){console.error("❌ Sign-out error:",e)}};return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col font-sans bg-gray-50",style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[(0,s.jsx)("header",{className:"bg-white shadow-sm py-3 rounded-t-2xl overflow-hidden sticky top-0 z-50",style:{top:"env(safe-area-inset-top, 0px)"},children:(0,s.jsxs)("div",{className:"max-w-lg mx-auto w-full px-4 flex justify-between items-center gap-2 min-w-0",children:[(0,s.jsx)("div",{className:"flex-shrink-0 min-w-0",children:"/settings"===r?(0,s.jsx)(n.default,{href:"/",className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition inline-flex items-center justify-center","aria-label":"Home",children:"\uD83C\uDFE0"}):(0,s.jsx)(n.default,{href:"/settings",className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition inline-flex items-center justify-center","aria-label":"Settings",children:"⚙️"})}),(0,s.jsx)("h1",{className:"text-base sm:text-lg font-semibold text-gray-800 flex-1 text-center min-w-0 truncate px-2",children:"/settings"===r?"Settings":"Suggestions"}),(0,s.jsx)("div",{className:"flex-shrink-0 min-w-0",children:(0,s.jsx)("button",{onClick:p,className:"bg-red-600 text-white px-3 py-1 text-xs sm:text-sm rounded-lg font-medium transition hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1 whitespace-nowrap",children:"Sign Out"})})]})}),(0,s.jsx)("main",{className:"flex-1 w-full text-gray-900",children:t}),(0,s.jsx)("footer",{className:"bg-white text-center text-xs text-gray-500 border-t py-3 rounded-b-2xl",children:(0,s.jsxs)("div",{className:"max-w-lg mx-auto w-full px-4 space-y-1",children:[(0,s.jsxs)("div",{children:["\xa9 ",new Date().getFullYear()," CardCompass"]}),(0,s.jsx)("div",{children:(0,s.jsx)(n.default,{href:"/privacy",className:"hover:text-gray-700 underline",children:"Privacy Policy"})})]})})]})}},4691:function(e,t,r){"use strict";var s=r(3827);t.Z=function(){return(0,s.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-4 border-blue-500 border-t-transparent"})})}},2406:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return o},useAuth:function(){return i}});var s=r(3827),n=r(4090),a=r(9263);let l=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,n.useState)(null),[i,c]=(0,n.useState)(!0),u=()=>{try{if("undefined"==typeof localStorage){console.log("⚠️ localStorage not available"),o(null),c(!1);return}let e=localStorage.getItem("cardscope_user");if(e){let t=JSON.parse(e);o(t),console.log("✅ User found in localStorage:",t.email)}else o(null),console.log("❌ No user found in localStorage")}catch(e){console.error("Error checking auth:",e),o(null)}finally{c(!1)}};(0,n.useEffect)(()=>{if(u(),a.dV.isNativePlatform()){console.log("\uD83D\uDCF1 Setting up deep link listeners...");let e=e=>{var t,r;console.log("\uD83D\uDCF1 Received appUrlOpen event:",null===(t=e.detail)||void 0===t?void 0:t.url),(null===(r=e.detail)||void 0===r?void 0:r.url)&&e.detail.url.includes("cardscope://")&&d(e.detail.url)};window.addEventListener("appUrlOpen",e);let t=e=>{console.log("\uD83D\uDCF1 Received deepLink event from native:",e.detail),d(e.detail)};window.addEventListener("deepLink",t);let r=()=>{let e=window.location.href;e&&e.includes("cardscope://")&&(console.log("\uD83D\uDCF1 Found cardscope:// in window.location:",e),d(e))};r();let s=setInterval(r,1e3);return()=>{window.removeEventListener("appUrlOpen",e),window.removeEventListener("deepLink",t),clearInterval(s)}}let e=e=>{if("cardscope_user"===e.key){if(e.newValue){let t=JSON.parse(e.newValue);o(t),console.log("✅ User updated from storage:",t.email)}else o(null),console.log("❌ User removed from storage")}};window.addEventListener("storage",e);let t=()=>{u()};return window.addEventListener("authUpdated",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("authUpdated",t)}},[]);let d=e=>{try{console.log("\uD83D\uDD17 Processing deep link URL:",e);let t=new URL(e),r=t.searchParams.get("status"),s=t.searchParams.get("userData");if(console.log("\uD83D\uDCF1 Deep link status:",r),console.log("\uD83D\uDCF1 Deep link userData:",s),"success"===r&&s){let e=JSON.parse(decodeURIComponent(s));console.log("\uD83D\uDCF1 Parsed user data from deep link:",e),localStorage.setItem("cardscope_user",JSON.stringify(e)),o(e),window.dispatchEvent(new Event("authUpdated")),console.log("✅ User data stored from deep link")}}catch(e){console.error("Error processing deep link:",e)}};return(0,s.jsx)(l.Provider,{value:{user:r,isLoading:i,signOut:()=>{localStorage.removeItem("cardscope_user"),o(null),console.log("✅ User signed out")}},children:t})}function i(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},826:function(e,t,r){"use strict";var s=r(3107);let n=(()=>{let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"https://cardscope-app.onrender.com":e.includes("10.0.2.2")?"http://10.0.2.2:8080":e.includes("192.168.")||e.includes("172.")?"http://".concat(e,":8080"):"https://cardscope-app.onrender.com"})();console.log("API Base URL →",n);let a=s.Z.create({baseURL:n,headers:{"Content-Type":"application/json"}});a.interceptors.response.use(e=>e,e=>{var t;return console.error("API Error:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),Promise.reject(e)}),t.Z=a}},function(e){e.O(0,[615,263,690,897,971,69,744],function(){return e(e.s=6370)}),_N_E=e.O()}]);