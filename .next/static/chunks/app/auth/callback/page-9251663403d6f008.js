(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{3889:function(e,t,o){Promise.resolve().then(o.bind(o,5554))},5554:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return i}});var n=o(3827),r=o(4090),s=o(7907);function a(){let e=(0,s.useRouter)(),t=(0,s.useSearchParams)();(0,r.useEffect)(()=>{let e=t.get("code"),n=t.get("error");if(n){console.error("OAuth error:",n),o("error=".concat(encodeURIComponent(n)));return}e?a(e):o("no_code")},[t,e]);let o=(t,o)=>{if(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){console.log("Detected mobile browser, attempting app redirect...");let e="cardscope:///?status=".concat(t);if(o&&"success"===t){let t=encodeURIComponent(JSON.stringify(o));e+="&userData=".concat(t),console.log("\uD83D\uDCF1 Including user data in redirect:",o),console.log("\uD83D\uDCF1 Full redirect URL:",e)}try{window.location.href=e,console.log("Attempted redirect via window.location.href")}catch(e){console.log("Method 1 failed:",e)}setTimeout(()=>{try{let t=document.createElement("iframe");t.style.display="none",t.src=e,document.body.appendChild(t),console.log("Attempted redirect via iframe"),setTimeout(()=>{document.body.removeChild(t)},1e3)}catch(e){console.log("Method 2 failed:",e)}},500),setTimeout(()=>{try{window.open(e,"_self"),console.log("Attempted redirect via window.open")}catch(e){console.log("Method 3 failed:",e)}},1e3),setTimeout(()=>{let e=document.getElementById("message");e&&(e.innerHTML='\n            <div style="text-align: center; padding: 20px; max-width: 400px; margin: 0 auto;">\n              <h2 style="color: #28a745; margin-bottom: 20px;">✅ Authentication Complete!</h2>\n              <p style="margin-bottom: 15px; font-size: 16px;">Your Google account has been successfully linked.</p>\n              <p style="margin-bottom: 20px; color: #666;">Please return to the <strong>CardScope</strong> app to continue.</p>\n              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">\n                <p style="margin: 0; font-size: 14px; color: #495057;">\n                  <strong>How to return to the app:</strong><br>\n                  • Swipe up from bottom (Android)<br>\n                  • Use recent apps button<br>\n                  • Tap the app icon on home screen\n                </p>\n              </div>\n              <button onclick="window.close()" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">\n                Close Browser\n              </button>\n            </div>\n          ')},2e3)}else e.push("/")},a=async e=>{try{let t=await fetch("/api/auth/google",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(t.ok){let{user:e}=await t.json();if(console.log("✅ Got user from OAuth:",e),localStorage.setItem("cardscope_user",JSON.stringify(e)),console.log("✅ Stored user in localStorage"),window.dispatchEvent(new Event("authUpdated")),console.log("✅ Dispatched authUpdated event"),window.Capacitor){console.log("\uD83D\uDCF1 Capacitor detected, attempting postMessage to store user data");try{window.postMessage({type:"OAUTH_SUCCESS",user:e},"*")}catch(e){console.error("❌ Failed to send postMessage:",e)}}console.log("\uD83D\uDD04 Redirecting to app with user data"),o("success",e)}else throw Error("Token exchange failed")}catch(e){console.error("Token exchange error:",e),o("error=authentication_failed")}};return(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Completing authentication..."}),(0,n.jsx)("div",{id:"message",className:"mt-4"})]})})}function i(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}),children:(0,n.jsx)(a,{})})}},7907:function(e,t,o){"use strict";var n=o(5313);o.o(n,"useParams")&&o.d(t,{useParams:function(){return n.useParams}}),o.o(n,"usePathname")&&o.d(t,{usePathname:function(){return n.usePathname}}),o.o(n,"useRouter")&&o.d(t,{useRouter:function(){return n.useRouter}}),o.o(n,"useSearchParams")&&o.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[971,69,744],function(){return e(e.s=3889)}),_N_E=e.O()}]);