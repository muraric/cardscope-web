(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{904:function(e,t,o){Promise.resolve().then(o.bind(o,4338))},4338:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return u},dynamic:function(){return c}});var n=o(3827),s=o(4090),l=o(7907),r=o(2406),a=o(826),i=o(9263);let c="force-dynamic";function u(){let e=(0,l.useRouter)(),{user:t,isLoading:o}=(0,r.useAuth)(),c=(0,s.useRef)(!1),[u,d]=(0,s.useState)(""),[p,g]=(0,s.useState)(""),[h,m]=(0,s.useState)("");(0,s.useEffect)(()=>{!t||o||c.current||(c.current=!0,console.log("✅ Login success → redirecting to /"),e.replace("/"))},[t,o,e]);let f=async e=>{if(e.preventDefault(),m(""),!u){m("Please enter your email");return}try{var t;let e=await a.Z.post("/api/auth/login",{email:u,password:p}),o={id:u,name:(null===(t=e.data)||void 0===t?void 0:t.name)||u.split("@")[0],email:u,picture:null};localStorage.setItem("cardscope_user",JSON.stringify(o)),console.log("✅ Stored user in localStorage:",o),window.dispatchEvent(new Event("authUpdated")),await new Promise(e=>setTimeout(e,200)),window.dispatchEvent(new Event("authUpdated")),console.log("✅ Manual login successful:",u),window.location.href="/"}catch(e){console.error("❌ Login failed:",e),m("Invalid email or password. Please try again.")}},v=async()=>{try{console.log("\uD83D\uDD0D Starting Google sign-in..."),console.log("\uD83D\uDCF1 Is native platform:",i.dV.isNativePlatform());let e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,t="https://accounts.google.com/o/oauth2/v2/auth?client_id=488875684334-urrslagsla2btuuri02acrunqum7d2bk.apps.googleusercontent.com&"+"redirect_uri=".concat(encodeURIComponent(e?"http://localhost:3000/auth/callback":"https://cardscope-web.vercel.app/auth/callback"),"&")+"response_type=code&scope=openid%20email%20profile&access_type=offline";console.log("\uD83D\uDCF1 OAuth URL:",t),i.dV.isNativePlatform()&&console.log("\uD83D\uDCF1 Navigating WebView to OAuth URL"),window.location.href=t}catch(e){console.error("❌ Google sign-in failed:",e),m("Google sign-in failed. Please try again.")}},w=async()=>{try{console.log("\uD83C\uDF4E Starting Apple sign-in...");let e=await fetch("/api/auth/providers");if(!(await e.json()).apple){m("Apple Sign-In is not configured. Please contact support or use another login method."),console.error("❌ Apple provider not available");return}window.location.href="/api/auth/signin/apple"}catch(e){console.error("❌ Apple sign-in failed:",e),m("Apple sign-in failed. Please try again.")}};return((0,s.useEffect)(()=>{"apple"===new URLSearchParams(window.location.search).get("error")&&fetch("/api/auth/providers").then(e=>e.json()).then(e=>{e.apple?m("Apple Sign-In failed. Please check that the Return URL 'https://cardscope-web.vercel.app/api/auth/callback/apple' is configured in Apple Developer Console."):m("Apple Sign-In is not configured. Please add environment variables to Vercel or use another login method.")}).catch(()=>{m("Apple Sign-In failed. Please check Apple Developer Console configuration.")})},[]),o)?(console.log("\uD83D\uDD04 Auth status: loading"),(0,n.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center space-y-3 text-gray-500",children:[(0,n.jsx)("img",{src:"/spinner.svg",alt:"Loading",className:"w-8 h-8 animate-spin"}),(0,n.jsx)("p",{children:"Checking your session..."})]})):t?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center text-gray-500",children:"Redirecting to your dashboard..."}):(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:(0,n.jsxs)("div",{className:"max-w-md w-full bg-white shadow-md rounded-lg p-6 sm:p-8 space-y-6",children:[(0,n.jsx)("h1",{className:"text-center text-xl font-bold",children:"\uD83D\uDD11 Login"}),h&&(0,n.jsx)("p",{className:"text-red-600 text-sm text-center",children:h}),(0,n.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,n.jsx)("input",{type:"email",className:"w-full border p-3 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",placeholder:"you@example.com",value:u,onChange:e=>d(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,n.jsx)("input",{type:"password",className:"w-full border p-3 rounded-lg text-sm focus:ring-2 focus:ring-blue-500",placeholder:"••••••••",value:p,onChange:e=>g(e.target.value)}),(0,n.jsx)("div",{className:"text-right mt-1",children:(0,n.jsx)("button",{type:"button",onClick:()=>e.push("/reset"),className:"text-sm text-blue-600 hover:underline",children:"Forgot password?"})})]}),(0,n.jsx)("button",{type:"submit",className:"btn btn-primary w-full",children:"Login"})]}),(0,n.jsxs)("div",{className:"flex items-center my-4",children:[(0,n.jsx)("div",{className:"flex-grow border-t border-gray-200"}),(0,n.jsx)("span",{className:"mx-2 text-gray-400 text-sm",children:"or"}),(0,n.jsx)("div",{className:"flex-grow border-t border-gray-200"})]}),(0,n.jsxs)("button",{onClick:v,className:"flex items-center justify-center w-full border border-gray-300 rounded-lg py-2 hover:bg-gray-50 transition",children:[(0,n.jsx)("img",{src:"https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg",alt:"Google",className:"h-5 w-5 mr-2"}),"Continue with Google"]}),(0,n.jsxs)("button",{onClick:w,className:"flex items-center justify-center w-full bg-black text-white rounded-lg py-2 hover:bg-gray-800 transition",children:[(0,n.jsx)("svg",{className:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"currentColor",children:(0,n.jsx)("path",{d:"M17.05 20.28c-.98.95-2.05.88-3.08.4-1.09-.5-2.08-.48-3.24 0-1.44.62-2.2.44-3.06-.4C4.79 15.25 3.8 10.45 6.05 7.96c1.15-1.23 2.5-1.93 4.05-1.93 1.18 0 2.06.4 3.08.88.78.38 1.48.58 1.98.58.44 0 1.15-.2 1.98-.58 1.02-.48 1.9-.88 3.08-.88 1.58 0 2.93.73 4.08 1.96-3.12 3.53-2.61 8.5 1.08 11.32-1.1 1.01-2.2 1.4-3.18 1.4zm-2.04-17.3c.15 1.15-.34 2.3-1.05 3.04-.73.76-1.9 1.25-3.04 1.15-.15-1.15.35-2.3 1.06-3.04.74-.76 1.91-1.24 3.03-1.15z"})}),"Continue with Apple"]}),(0,n.jsx)("div",{className:"text-center mt-4",children:(0,n.jsxs)("p",{className:"text-sm",children:["New user?"," ",(0,n.jsx)("button",{onClick:()=>e.push("/signup"),className:"text-blue-600 hover:underline",children:"Sign up here"})]})})]})})}},2406:function(e,t,o){"use strict";o.r(t),o.d(t,{AuthProvider:function(){return a},useAuth:function(){return i}});var n=o(3827),s=o(4090),l=o(9263);let r=(0,s.createContext)(void 0);function a(e){let{children:t}=e,[o,a]=(0,s.useState)(null),[i,c]=(0,s.useState)(!0),u=()=>{try{if("undefined"==typeof localStorage){console.log("⚠️ localStorage not available"),a(null),c(!1);return}let e=localStorage.getItem("cardscope_user");if(e){let t=JSON.parse(e);a(t),console.log("✅ User found in localStorage:",t.email)}else a(null),console.log("❌ No user found in localStorage")}catch(e){console.error("Error checking auth:",e),a(null)}finally{c(!1)}};(0,s.useEffect)(()=>{if(u(),l.dV.isNativePlatform()){console.log("\uD83D\uDCF1 Setting up deep link listeners...");let e=e=>{var t,o;console.log("\uD83D\uDCF1 Received appUrlOpen event:",null===(t=e.detail)||void 0===t?void 0:t.url),(null===(o=e.detail)||void 0===o?void 0:o.url)&&e.detail.url.includes("cardscope://")&&d(e.detail.url)};window.addEventListener("appUrlOpen",e);let t=e=>{console.log("\uD83D\uDCF1 Received deepLink event from native:",e.detail),d(e.detail)};window.addEventListener("deepLink",t);let o=()=>{let e=window.location.href;e&&e.includes("cardscope://")&&(console.log("\uD83D\uDCF1 Found cardscope:// in window.location:",e),d(e))};o();let n=setInterval(o,1e3);return()=>{window.removeEventListener("appUrlOpen",e),window.removeEventListener("deepLink",t),clearInterval(n)}}let e=e=>{if("cardscope_user"===e.key){if(e.newValue){let t=JSON.parse(e.newValue);a(t),console.log("✅ User updated from storage:",t.email)}else a(null),console.log("❌ User removed from storage")}};window.addEventListener("storage",e);let t=()=>{u()};return window.addEventListener("authUpdated",t),()=>{window.removeEventListener("storage",e),window.removeEventListener("authUpdated",t)}},[]);let d=e=>{try{console.log("\uD83D\uDD17 Processing deep link URL:",e);let t=new URL(e),o=t.searchParams.get("status"),n=t.searchParams.get("userData");if(console.log("\uD83D\uDCF1 Deep link status:",o),console.log("\uD83D\uDCF1 Deep link userData:",n),"success"===o&&n){let e=JSON.parse(decodeURIComponent(n));console.log("\uD83D\uDCF1 Parsed user data from deep link:",e),localStorage.setItem("cardscope_user",JSON.stringify(e)),a(e),window.dispatchEvent(new Event("authUpdated")),console.log("✅ User data stored from deep link")}}catch(e){console.error("Error processing deep link:",e)}};return(0,n.jsx)(r.Provider,{value:{user:o,isLoading:i,signOut:()=>{localStorage.removeItem("cardscope_user"),a(null),console.log("✅ User signed out")}},children:t})}function i(){let e=(0,s.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},826:function(e,t,o){"use strict";var n=o(3107);let s=(()=>{let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"https://cardscope-app.onrender.com":e.includes("10.0.2.2")?"http://10.0.2.2:8080":e.includes("192.168.")||e.includes("172.")?"http://".concat(e,":8080"):"https://cardscope-app.onrender.com"})();console.log("API Base URL →",s);let l=n.Z.create({baseURL:s,headers:{"Content-Type":"application/json"}});l.interceptors.response.use(e=>e,e=>{var t;return console.error("API Error:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),Promise.reject(e)}),t.Z=l}},function(e){e.O(0,[615,263,971,69,744],function(){return e(e.s=904)}),_N_E=e.O()}]);